{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "MOL",
  "scopeName": "source.mol",
  "patterns": [
    { "include": "#comments" },
    { "include": "#strings" },
    { "include": "#numbers" },
    { "include": "#keywords" },
    { "include": "#domain-keywords" },
    { "include": "#domain-types" },
    { "include": "#control-flow" },
    { "include": "#operators" },
    { "include": "#builtins" },
    { "include": "#function-def" },
    { "include": "#function-call" },
    { "include": "#constants" },
    { "include": "#variables" }
  ],
  "repository": {
    "comments": {
      "patterns": [
        {
          "name": "comment.line.double-dash.mol",
          "match": "--.*$"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.double.mol",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.mol",
              "match": "\\\\."
            }
          ]
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.float.mol",
          "match": "\\b[0-9]+\\.[0-9]+\\b"
        },
        {
          "name": "constant.numeric.integer.mol",
          "match": "\\b[0-9]+\\b"
        }
      ]
    },
    "keywords": {
      "patterns": [
        {
          "name": "keyword.control.mol",
          "match": "\\b(if|then|elif|else|end|while|for|in|do|define|return|begin|let|be|set|to|show|and|or|not|is|pipeline|guard)\\b"
        }
      ]
    },
    "domain-keywords": {
      "patterns": [
        {
          "name": "keyword.other.domain.mol",
          "match": "\\b(trigger|link|process|access|sync|evolve|emit|listen|with)\\b"
        }
      ]
    },
    "domain-types": {
      "patterns": [
        {
          "name": "entity.name.type.mol",
          "match": "\\b(Thought|Memory|Node|Stream|Number|Text|Bool|List|Document|Chunk|Embedding|VectorStore)\\b"
        }
      ]
    },
    "control-flow": {
      "patterns": [
        {
          "name": "keyword.control.flow.mol",
          "match": "\\b(if|then|elif|else|end|while|for|do|return|pipeline|guard)\\b"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.comparison.mol",
          "match": "(\\|>|>=|<=|>|<|is\\s+not|is)"
        },
        {
          "name": "keyword.operator.arithmetic.mol",
          "match": "[+\\-*/%]"
        },
        {
          "name": "keyword.operator.logical.mol",
          "match": "\\b(and|or|not)\\b"
        }
      ]
    },
    "builtins": {
      "patterns": [
        {
          "name": "support.function.builtin.mol",
          "match": "\\b(len|type_of|to_text|to_number|range|abs|round|sqrt|max|min|sum|sort|reverse|push|pop|keys|values|contains|join|split|upper|lower|trim|replace|slice|clock|wait|to_json|from_json|inspect|load_text|chunk|embed|store|retrieve|cosine_sim|think|recall|classify|summarize|display|tap|assert_min|assert_not_null|map|filter|reduce|flatten|unique|zip|enumerate|count|find|find_index|take|drop|group_by|chunk_list|every|some|floor|ceil|log|sin|cos|tan|pi|e|pow|clamp|lerp|mean|median|stdev|variance|percentile|starts_with|ends_with|pad_left|pad_right|repeat|char_at|index_of|format|hash|uuid|base64_encode|base64_decode|sort_by|sort_desc|binary_search|random|random_int|shuffle|sample|choice|print|merge|pick|omit|is_null|is_number|is_text|is_list|is_map)\\b"
        }
      ]
    },
    "function-def": {
      "patterns": [
        {
          "match": "\\b(define|pipeline)\\s+([a-zA-Z_][a-zA-Z0-9_]*)",
          "captures": {
            "1": { "name": "keyword.control.mol" },
            "2": { "name": "entity.name.function.mol" }
          }
        }
      ]
    },
    "function-call": {
      "patterns": [
        {
          "match": "\\b([a-zA-Z_][a-zA-Z0-9_]*)\\s*(?=\\()",
          "captures": {
            "1": { "name": "entity.name.function.call.mol" }
          }
        }
      ]
    },
    "constants": {
      "patterns": [
        {
          "name": "constant.language.mol",
          "match": "\\b(true|false|null)\\b"
        }
      ]
    },
    "variables": {
      "patterns": [
        {
          "match": "\\b(let)\\s+([a-zA-Z_][a-zA-Z0-9_]*)",
          "captures": {
            "1": { "name": "keyword.control.mol" },
            "2": { "name": "variable.other.mol" }
          }
        },
        {
          "match": "\\b(set)\\s+([a-zA-Z_][a-zA-Z0-9_]*)",
          "captures": {
            "1": { "name": "keyword.control.mol" },
            "2": { "name": "variable.other.mol" }
          }
        }
      ]
    }
  }
}
